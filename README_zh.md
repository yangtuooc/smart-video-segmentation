# Smart Video Segmentation

æ™ºèƒ½è§†é¢‘åˆ†å‰²å·¥å…· - åŸºäºæ·±åº¦å­¦ä¹ çš„è§†é¢‘è‡ªåŠ¨åˆ‡åˆ†æ–¹æ¡ˆ

## æ¦‚è¿°

æœ¬å·¥å…·ç»“åˆ**é•œå¤´æ£€æµ‹**å’Œ**è¯´è¯äººè¯†åˆ«**æŠ€æœ¯ï¼Œæ™ºèƒ½åˆ¤æ–­è§†é¢‘çš„æœ€ä½³åˆ‡åˆ†ç‚¹ã€‚é€‚ç”¨äºå¹¿å‘Šç´ ææ‹†åˆ†ã€è§†é¢‘å‰ªè¾‘é¢„å¤„ç†ç­‰åœºæ™¯ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¬ **é•œå¤´è¾¹ç•Œæ£€æµ‹** - TransNetV2 æ·±åº¦å­¦ä¹ æ¨¡å‹
- ğŸ¤ **è¯­éŸ³è¯†åˆ«** - OpenAI Whisper å¤šè¯­è¨€æ”¯æŒ
- ğŸ‘¥ **è¯´è¯äººè¯†åˆ«** - Resemblyzer åµŒå…¥å‘é‡ + è‡ªåŠ¨èšç±»
- ğŸ§  **æ™ºèƒ½å†³ç­–** - å¤šä¿¡å·èåˆåˆ¤æ–­åˆ‡åˆ†ç‚¹
- âœ‚ï¸ **è§†é¢‘å¯¼å‡º** - FFmpeg æ— æŸåˆ†å‰²

## ç¯å¢ƒè¦æ±‚

- Python 3.8+
- FFmpegï¼ˆéœ€è¦é¢„å…ˆå®‰è£…å¹¶æ·»åŠ åˆ° PATHï¼‰

## å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd smart-video-segmentation

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

## å¿«é€Ÿå¼€å§‹

```bash
# åˆ†æå¹¶åˆ†å‰²è§†é¢‘
python main.py input.mp4

# ä»…åˆ†æï¼Œä¸åˆ†å‰²
python main.py input.mp4 --no-split

# æŒ‡å®šè¾“å‡ºç›®å½•
python main.py input.mp4 -o ./output

# å¯¼å‡ºåˆ†æç»“æœä¸º JSON
python main.py input.mp4 --export-json result.json --no-split
```

## ä½¿ç”¨è¯´æ˜

### å‘½ä»¤è¡Œå‚æ•°

```
python main.py <video> [options]
```

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `video` | str | å¿…éœ€ | è¾“å…¥è§†é¢‘æ–‡ä»¶è·¯å¾„ |
| `-o, --output` | str | `./segments` | è¾“å‡ºç›®å½• |
| `--whisper-model` | str | `base` | Whisper æ¨¡å‹: `tiny`, `base`, `small`, `medium`, `large` |
| `--language` | str | `zh` | è¯­éŸ³è¯­è¨€ä»£ç  |
| `--shot-threshold` | float | `0.5` | é•œå¤´æ£€æµ‹é˜ˆå€¼ (0-1) |
| `--min-segment` | float | `2.0` | æœ€å°ç‰‡æ®µæ—¶é•¿ (ç§’) |
| `--no-split` | flag | - | ä»…åˆ†æï¼Œä¸åˆ†å‰²è§†é¢‘ |
| `--export-json` | str | - | å¯¼å‡ºåˆ†æç»“æœåˆ° JSON |

### è¾“å‡ºç¤ºä¾‹

```
============================================================
æ™ºèƒ½è§†é¢‘åˆ†å‰²å·¥å…·
============================================================
è¾“å…¥è§†é¢‘: example.mp4

[1/4] é•œå¤´æ£€æµ‹
----------------------------------------
æ­£åœ¨åŠ è½½ TransNetV2 æ¨¡å‹...
æ£€æµ‹åˆ° 8 ä¸ªé•œå¤´åˆ‡æ¢ç‚¹
è§†é¢‘æ—¶é•¿: 139.60 ç§’

[2/4] è¯­éŸ³è¯†åˆ«
----------------------------------------
è¯†åˆ«åˆ° 52 ä¸ªè¯­éŸ³ç‰‡æ®µ

[3/4] è¯´è¯äººå˜åŒ–æ£€æµ‹
----------------------------------------
è‡ªåŠ¨æ£€æµ‹åˆ° 4 ä¸ªè¯´è¯äºº (Silhouette Score: 0.365)
æ£€æµ‹åˆ°è¯´è¯äººåˆ‡æ¢ç‚¹: 3 ä¸ª

[4/4] æ™ºèƒ½åˆ†æ
----------------------------------------
æœ€ç»ˆåˆ‡åˆ†ç‚¹: 2 ä¸ª
  - 37.97s (é•œå¤´åˆ‡æ¢ä¸”è¯´è¯äººå˜åŒ–)
  - 101.60s (é•œå¤´åˆ‡æ¢ä¸”è¯´è¯äººå˜åŒ–)

åˆ†å‰²åå°†äº§ç”Ÿ 3 ä¸ªç‰‡æ®µ:
  ç‰‡æ®µ 0: 0.00s - 37.97s (æ—¶é•¿: 37.97s)
  ç‰‡æ®µ 1: 37.97s - 101.60s (æ—¶é•¿: 63.63s)
  ç‰‡æ®µ 2: 101.60s - 139.60s (æ—¶é•¿: 38.00s)
```

### JSON è¾“å‡ºæ ¼å¼

```json
{
  "video": "example.mp4",
  "duration": 139.60,
  "shot_changes": [5.93, 37.97, ...],
  "speech_segments": [
    {"start": 0.00, "end": 7.72, "text": "..."}
  ],
  "final_splits": [
    {"timestamp": 37.97, "reason": "é•œå¤´åˆ‡æ¢ä¸”è¯´è¯äººå˜åŒ–", "confidence": 0.9}
  ],
  "segments": [
    {"index": 0, "start": 0.0, "end": 37.97, "duration": 37.97}
  ]
}
```

## é¡¹ç›®ç»“æ„

```
smart-video-segmentation/
â”œâ”€â”€ main.py                    # ç¨‹åºå…¥å£ï¼Œå‚æ•°è§£æï¼Œæµç¨‹ç¼–æ’
â”œâ”€â”€ models.py                  # æ•°æ®æ¨¡å‹ (SpeechSegment, SplitPoint, etc.)
â”œâ”€â”€ utils.py                   # å…¬å…±å·¥å…· (éŸ³é¢‘æå–, è§†é¢‘æ—¶é•¿è·å–)
â”œâ”€â”€ shot_detector.py           # é•œå¤´æ£€æµ‹ (TransNetV2)
â”œâ”€â”€ speech_recognizer.py       # è¯­éŸ³è¯†åˆ« (Whisper)
â”œâ”€â”€ speaker_change_detector.py # è¯´è¯äººæ£€æµ‹ (Resemblyzer + Clustering)
â”œâ”€â”€ smart_segmenter.py         # æ™ºèƒ½èåˆå†³ç­–
â”œâ”€â”€ video_splitter.py          # è§†é¢‘åˆ†å‰² (FFmpeg)
â””â”€â”€ requirements.txt
```
